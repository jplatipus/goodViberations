<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>goodViberations Data Layer</title>
    <link rel="stylesheet" href="img/styles.css?v=6">
</head>
<body>
<a href="ReadMe.html"><- ReadMe.html</a>
<h1>goodViberations: Data Layer</h1>
<h2>Introduction</h2>
<p>
This document describes:
</p>
<ul>
    <li>The data structures used by the app</li>
    <li>The storage and retrieval of data from the app</li>
</ul>
<h2>Data structures</h2>
<p>
    The data structures used by the app are based on a map of entries. The key to
    the map is the name field of DataEntry converted to lower case. This ensures
    case insensitive uniqueness of names used in the app.
</p>
<p>
</p>
<p>
    Each entry is a master, with a fixed set of fields and a detail that is a list of detail fields.
    The class name is DataEntry. The package is com.j3t.dataentryapp.datalayer.
</p>
<p>
    The fields of the DataEntry are kept in a class called DataField.
    The package is com.j3t.dataentryapp.datalayer.
</p>

<h3>The DataEntry class has the following fixed set of fields</h3>
<ul>
    <li>version: this is a constant integer value that is used to track changes in the
        class source code. Initially the version has a value set to 1.
    </li>
    <li>name: the name of the entry, the value is unique to each entry, uniqueness is case insensitive.
        That is to say that a the values "a Name", "A Name", "a name" or "A NAME" are all considered to be
        the same name when checking for uniqueness.
        The name may not be an empty string, it must contain at least one character.</li>
    <li>notes: a multiline text entry, the value is not unique to each entry, it may be an empty string.</li>
    <li>creation date and time: a date time. The initial value is the current date and time.</li>
    <li>last modified date and time: a date time. The initial value is the current date and time.</li>
    <li>password: a password entry, the value is not unique to each entry</li>
</ul>
<p>
    The DataEntry class also has a list of DataField fields, the detail fields, as described below.
</p>
<h3>DataField fields</h3>
<p>
    DataField field instances relate to a specific DataEntry entry instance.
    DataField fields can be considered to be a set of text fields, each field has a name and a value.
    The name must be unique to the master entry instance.
</p>
<p>
    Some field values reflect a data type,
    and so have a syntax associated with them. For example, email must be a valid email address syntax,
    url must be a valid http url syntax.
</p>
<h2>Data storage and retrieval</h2>
<p>
    The map of DataEntry instances are saved and loaded from a file in the context.filesDir, as xml.<br/>
    A class called <strong>DataLayer</strong> in the package com.j3t.dataentryapp.datalayer has the methods all other
    classes in the app use.
</p>
<p>
    The following methods are present in the DataLayer class:
    <table class="tblClassCode">
        <tr>
            <th>Method</th><th>parameters</th><th>Description</th>
        </tr>
        <tr>
            <td>createStore</td>
            <td>data: map of DataEntry instances</td>
            <td>
                The following operations are carried out by this method:
                <ol>
                    <li>
                        checks how many files exist in the context.filesDir, if there are 5 or more files,
                        the oldest file is deleted.
                    </li>
                    <li>
                        a new file whose name is made of "info" + ddmmyyyyhhmmss + random integer between 0 and 100 + ".xml" is created in the
                        context.filesDir.
                    </li>
                    <li>
                        The data is written to the file as xml. The DataEntry map instance, sorted by the key (name)
                        field.The sorted map is returned by the method.
                    </li>
                </ol>
            </td>
        </tr>
        <tr>
            <td>saveStore</td>
            <td>data: map of DataEntry instances</td>
            <td>calls the createStore method. Returns the value returned by the createStore method.</td>
        </tr>
        <tr>
            <td>loadStore</td>
            <td>no parameter</td>
            <td>
                if there are no files in the context.filesDir, the method returns a new map of
                DataEntry instances.<br/><br/>
                if there are files in the context.filesDir: the contents of the latest xml file in the
                context.filesDir are loaded into a new map of DataEntry instances.
                The method returns  the map of DataEntry instances, sorted by the key (name)
                field.
            </td>
        </tr>
        <tr>
            <td>deleteStore</td>
            <td>no parameter</td>
            <td>Deletes all the files in the context.filesDir.</td>
        </tr>
        <tr>
            <td>storeExists</td>
            <td>no parameter</td>
            <td>Boolean method returns true if a store exists, false otherwise.</td>
        </tr>
    </table>
</p>
</body>